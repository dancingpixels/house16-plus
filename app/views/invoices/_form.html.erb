<%= form_with model: @invoice, local: true do |form_builder| %>
  <!-- Other invoice fields -->
  <div class="mb-3">
    <%= form_builder.text_field :customer_name, class: "form-control", placeholder: "Customer Name" %>
  </div>

  <div data-controller="line-items">
    <div data-line-items-target="container">
      <%= form_builder.fields_for :line_items do |lf| %>
        <%= render 'line_item_fields', f: lf %>
      <% end %>
    </div>

    <!-- Template used by Stimulus to inject new line items -->
    <template data-line-items-target="template">
      <%=
        form_builder.fields_for :line_items, LineItem.new, child_index: "NEW_RECORD" do |lf|
          render 'line_item_fields', f: lf
        end
      %>
    </template>

    <button type="button" class="btn btn-outline-primary mt-2" data-action="click->line-items#add">
      âž• Add Line Item
    </button>
  </div>

  <div class="mt-4">
    <%= form_builder.submit "Save Invoice", class: "btn btn-primary" %>
  </div>
<% end %>
